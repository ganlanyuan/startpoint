<header class="site-header" role="banner">
  {# skip-nav-link: http://a11yproject.com/posts/skip-nav-links/ #}
  <a href="#main" class="skip-link visually-hidden">Skip to main content</a>
  <noscript>
    <p class="enable-js">
      To enjoy our website, you'll need to enable <b>JavaScript</b> in your web browser. Please <a href="http://enable-javascript.com/" target="_blank"><b>click here</b></a> to learn how.
    </p>
  </noscript>
  <!--[if lt IE 9]>
    <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/" target="_blank">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->

  <div class="container">
    <button aria-controls="main-nav"><span class="visually-hidden">Menu</span></button> {# aria-expanded="true" #}
    {% include './_logo.njk' %}
    {% if page === 'home' %}
      <h1 class="visually-hidden">{{ brand }}</h1>
    {% endif %}

    {# nav #}
    <nav role="navigation" aria-label="Main Navigation" id="main-nav"> {# aria-hidden="false" #}
      <ul>
        {% for section, subSection in navMain %}
          <li class="has-submenu">
            <a href="{{ baseurl }}/{{ section | lower | replace(r/\s+/g, '-') | replace(r/\./g, '') }}" aria-haspopup="true">{{ section | capitalize }}</a> {# aria-expanded="true" #}
            {# <button><span class="visually-hidden">show submenu for "{{ section | capitalize }}"</span></button> #}
            <ul> {# aria-hidden="false" #}
              {% for item in subSection %}
                <li><a href="{{ baseurl }}/{{ section | lower | replace(r/\s+/g, '-') | replace(r/\./g, '') }}/{{ item | lower | replace(r/\s+/g, '-') | replace(r/\./g, '') }}">{{ item }}</a></li>
              {% endfor %}
            </ul>
          </li>
        {% endfor %}
      </ul>
    </nav>
    <script>
      var menuItems = document.querySelectorAll('#main-nav .has-submenu');
      [].forEach.call(menuItems, function(el, i){
        var activatingA = el.querySelector('a');
        var btn = '<button><span class="aria-hidden">▾</span><span class="visually-hidden">show submenu for “' + activatingA.text + '”</span></button>';
        activatingA.insertAdjacentHTML('afterend', btn);

        el.querySelector('button').addEventListener("click",  function(e){
          var parent = this.parentNode;
          if (parent.className == "has-submenu") {
            parent.className = "has-submenu open";
            parent.querySelector('a').setAttribute('aria-expanded', "true");
            parent.querySelector('button').setAttribute('aria-expanded', "true");
          } else {
            parent.className = "has-submenu";
            parent.querySelector('a').setAttribute('aria-expanded', "false");
            parent.querySelector('button').setAttribute('aria-expanded', "false");
          }
          e.preventDefault();
        });
      });
    </script>

    <nav role="navigation" aria-labelledby="navheading">
      <h3 id="navheading">About Us</h3>
      <ul>
        {% for section in navSub %}
          <li><a href="{{ baseurl }}/{{ section | lower | replace(r/\s+/g, '-') | replace(r/\./g, '') }}">{{ section | capitalize }}</a></li>
        {% endfor %}
      </ul>
    </nav>
  </div>
</header>